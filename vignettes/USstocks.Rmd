---
title: "USstocks"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

#### Abstract
- Abstract

## Introduction
- Brief introduction to what's in this package 
- Highlight interesting components/results

## Data
- How to access this data?
- Describe where the data came from
- Describe how we "filtered" out the outliers

## Cool things
- Looking at performance of stocks over time
- Comparing different stocks 
- Looking at stocks' stability over time 

- Stock Analysis: time-series, simple-moving averages, moving average cross-over with buffer, resistance bands
- Perhaps running regression?  

- Visuals of the stuff above (ggplot2)
- fanplot?

## Removing Outliers 
```{r, eval = FALSE}
#Removing the outliers 

#1. Looking at stock with total return (daily) > 50%

unwanted <- stocks %>% filter(tret > 50)

#getting all the companies with atleast 1 date of tret > 50%
names <- unique(unwanted$name)

#Looking at them individually

#1. CHATHAM 
stocks %>% filter(name == names[1]) %>% arrange(v.date)
stocks %>% filter(name == names[1]) %>% arrange(desc(tret)) %>% dim
stocks <- filter(stocks, name != "CHATHAM CORP-DE")
#clearly, outlier, total.return in 1998, extremely low volume ==> REMOVE ALL 

#2. STRATOSPHER CORP
stocks %>% filter(name == names[2]) %>% arrange(desc(tret)) %>% head
stocks %>% filter(name == names[2]) %>% arrange(desc(tret)) %>% dim
stocks <- filter(stocks, (name != "STRATOSPHERE CORP") | (v.date != "1998-11-24")) 
## logical OR works better because if 1st condition evaluations to true, then it doesn't need to check second condition
#seems like, only 1 day is an outlier, everything else is good ==> REMOVE ONLY THE OUTLIER

#3. CYCLELOGIC INC
stocks %>% filter(name == names[3]) %>% arrange(desc(tret)) %>% head
stocks %>% filter(name == names[3]) %>% arrange(desc(tret)) %>% dim
stocks <- filter(stocks, (name != "CYCLELOGIC INC") | (v.date != "2002-06-07")) 
stocks <- filter(stocks, (name != "CYCLELOGIC INC") | (v.date != "2003-08-26")) 
#seems like, only 2 days are outliers, everything else is good ==> REMOVE ONLY THE OUTLIER

#4. 
stocks %>% filter(name == names[4]) %>% arrange(desc(tret)) %>% head
stocks %>% filter(name == names[4]) %>% arrange(desc(tret)) %>% dim 
stocks <- filter(stocks, (name != "METRICOM INC") | (v.date != "2003-12-04")) 
#seems like, only 1 day is an outlier, everything else is good ==> REMOVE ONLY THE OUTLIER

#5. 
stocks %>% filter(name == names[5]) %>% arrange(desc(tret)) %>% head
stocks %>% filter(name == names[5]) %>% arrange(desc(tret)) %>% dim 
stocks <- filter(stocks, (name != "MARCHFIRST INC") | (v.date != "2003-11-07")) 
#REMOVE ONLY THE OUTLIER

#6. ####???????? what to do?
stocks %>% filter(name == names[6]) %>% arrange(desc(tret)) %>% head
stocks %>% filter(name == names[6]) %>% arrange(desc(tret)) %>% dim 

#7. ##what to do?
stocks %>% filter(name == names[7]) %>% arrange(desc(tret)) %>% head
stocks %>% filter(name == names[7]) %>% arrange(desc(tret)) %>% dim 



#Looking at the plot of total returns
#stocks %>% ggplot(aes(v.date, tret)) + geom_point()
#Filtering out total daily return > 50 
#stocks <- stocks %>% filter(tret <= 50)

#Alternatively: 
#unwanted <- filter(stocks, tret > 50)
#x <- stocks
#x <- filter(x, ! symbol %in% unwanted$symbol)
```

## Summary

## Bibliography 

##Potential Code We Could Use
```{r,eval=FALSE}
#This file contains some of the draft R code for 
#what we might want to potentially include in the vignette (rmd file)

#----------------------------------------------------#

library(lubridate)
library(dplyr)
library(tidyr)
library(ggplot2)

library(USstocks)
data(stocks)

###If we want to look at a specific stock and its performance:

#all of the years
filter(stocks, symbol == "MSFT")

#the year 2002
filter(stocks, symbol == "MSFT", year == 2002)
stocks %% filter(symbol == "MSFT", year == 2002)


###Chaining with the %>% operator from dplyr

stocks %>%
  filter(symbol == "IBM") %>%
  arrange(v.date) %>%
  ggplot() + geom_point(aes(x = v.date, y = price.unadj, shape = "price unadjusted", colour = "price unadjusted")) + geom_point(aes(x = v.date, y = price, shape = "price", colour = "price")) 

##Example of Key Statistics
stocks %>% 
  filter(symbol == "IBM") %>%
  summarize(mean_volume = mean(volume))

stocks %>%  
  filter(symbol == "MSFT") %>%
  summarise_each(funs(mean, median), volume, volume.unadj, price, price.unadj)

###If you only want certain parts of the stock, it is very easy to do 
#with the filter() function in dplyr

stocks  %>% 
  filter(top.1500 == "TRUE", volume > 100000, year == 2000) %>%
  tbl_df

##Visualizing returns
#Notice that there are some far outliers in our dataset

stocks  %>% group_by(v.date)  %>% 
  summarize(sd_ret = sd(tret, na.rm = TRUE))  %>% 
  ggplot(aes(v.date, sd_ret)) + geom_point()

## We can use the following command to examine these outliers
x <- stocks
x <- filter(x, tret <= 40)
x  %>% 
  select(-id) %>% 
  filter(row_number(desc(tret)) < 10) %>% 
  arrange(desc(tret))

#Looking at these outliers
stocks  %>% filter(tret > 50) %>% arrange(id)

##Creating a local variable, and then we can mess around with the local variables by deleting outliers
x <- stocks
x <- filter(x, tret <= 50)
#unwanted <- filter(stocks, tret > 50)
#x <- stocks
#x <- filter(x, ! symbol %in% unwanted$symbol)

##Looking at the new standard deviation plot, we've removed a lot of outliers 
x  %>% group_by(v.date)  %>% 
  summarize(sd_ret = sd(tret, na.rm = TRUE))  %>% 
  ggplot(aes(v.date, sd_ret)) + geom_point()
```
